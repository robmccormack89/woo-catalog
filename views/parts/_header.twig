{% import "_snippets.twig" as snippets %}

<header class="site-header">
  <nav class="uk-navbar-container">
    <div class="uk-container" uk-navbar>
      
      {# logo/site_title #}
      <div class="uk-navbar-left">
        <a class="uk-navbar-item uk-logo uk-text-bold" href="{{ site.link|e('esc_url') }}">
          {% if theme.logo %}
            <img src="{{ theme.logo.src|e('esc_url') }}" width="{{ theme.logo.w }}" height="{{ theme.logo.h }}" alt="{{ theme.logo.alt|e('esc_html') }}">
          {% else %}
            {{ site.title|e('esc_html') }}
          {% endif %}
        </a>
    	</div>
      
      {# main menu/s #}
      {% if has_menu_main %}
        <div class="uk-navbar-right">
          <ul class="uk-navbar-nav">
            
            {# main menu items #}
            {% for item in menu_main.get_items %}
              {% if item.get_children %}
                <li class="uk-visible@m {{ item.classes|join(' ')|e('esc_html') }}">
                  <a href="{{ item.get_link|e('esc_url') }}">{{ item.title|e('esc_html') }}</a>
                  <div uk-dropdown>
                    <ul class="uk-nav uk-dropdown-nav">
                      {% for child in item.get_children %}
                        <li class="{{ child.classes|join(' ')|e('esc_html') }}">
                          <a href="{{ child.get_link|e('esc_url') }}">{{ child.title|e('esc_html') }}</a>
                          {% if child.children %}
                            <div uk-dropdown="pos: right-top">
                              <ul class="uk-nav uk-dropdown-nav">
                                {% for third in child.children %}
                                  <li class="{{ third.classes|join(' ')|e('esc_html') }}">
                                    <a href="{{ third.get_link|e('esc_url') }}">{{ third.title|e('esc_html') }}</a>
                                  </li>
                                {% endfor %}
                              </ul>
                            </div>
                          {% endif %}
                        </li>
                      {% endfor %}
                    </ul>
                  </div>
                </li>
              {% else %}
                <li class="uk-visible@m {{ item.classes|join(' ')|e('esc_html') }}">
                  <a href="{{ item.link|e('esc_url') }}">{{ item.title|e('esc_html') }}</a>
                </li>
              {% endif %}
            {% endfor %}
            
            {# account toggle #}
            <li class="user-icon uk-visible@m">
              <a href="{{dashboard_endpoint|e('esc_url')}}">
                {{ snippets.account_icon() }}
              </a>
            </li>
            
            {# cart toggle #}
            <li class="basket-icon uk-visible@m">
              <a href="#MiniCartModal" uk-toggle>
                
                {{ snippets.basket_icon() }}
                
                <span class="uk-position-relative">
                  <span class="">
                    <span class="header-cart-count">{{ WC.cart.get_cart_contents_count()|e('wp_kses_post') }}</span>
                    <span class="subtotal-cart">{{ WC.cart.get_cart_subtotal()|e('wp_kses_post') }}</span>
                  </span>
                </span>
                
              </a>
            </li>
            
            {# search toggle #}
            <li class="search-icon uk-visible@m" hidden>
              <a href="#ModalSearch" uk-toggle>
                {{ snippets.search_icon() }}
              </a>
            </li>
            
            {# mobile toggle #}
            <li class="uk-hidden@m">
              <a class="uk-navbar-toggle" uk-toggle="target: #SlideInMenu">{{ snippets.menu_bars_icon() }}</a>
            </li>
            
          </ul>
      	</div>
      {% endif %}
      
    </div>
  </nav>
</header>

{# mobile menu offcanvas #}
{% if has_menu_main %}
  <nav id="SlideInMenu" class="mobile-slide-navbar" uk-offcanvas="mode: push; overlay: true">
    <div class="uk-offcanvas-bar uk-offcanvas-bar-animation uk-offcanvas-slide uk-padding-small">
      
      <a class="uk-offcanvas-close uk-position-top-right uk-position-small uk-padding-remove">{{ snippets.close_menu_icon() }}</a>
      
      {# mobile menu nav #}
      <ul class="uk-nav-default uk-nav-parent-icon" uk-nav="multiple: true">
        
        {# mobile menu header #}
        <li class="uk-nav-header uk-padding-remove uk-margin-small-bottom">
          {{ menu_main.title|e('esc_html') }}
        </li>
        
        <li class="uk-nav-divider"></li>
        
        {# mobile menu #}
        {% for item in menu_main.get_items %}
          {% if item.get_children %}
            <li class="{{ item.classes|join(' ')|e('esc_html') }} uk-parent">
              <a href="{{ item.link|e('esc_url') }}">{{ item.title|e('esc_html')}}</a>
              <ul class="uk-nav-sub">
                {% for child in item.get_children %}
                  <li class="{{ child.classes|join(' ')|e('esc_html') }}">
                    <a href="{{ child.get_link|e('esc_url') }}">- {{ child.title|e('esc_html')}}</a>
                    {% if child.children %}
                      <ul class="uk-nav-sub">
                        {% for third in child.children %}
                          <li class="{{ child.classes|join(' ')|e('esc_html') }}">
                            <a href="{{ child.get_link|e('esc_url') }}">- {{ child.title|e('esc_html')}}</a>
                          </li>
                        {% endfor %}
                      </ul>
                    {% endif %}
                  </li>
                {% endfor %}
              </ul>
            </li>
          {% else %}
            <li class="{{ item.classes|join(' ')|e('esc_html') }}">
              <a href="{{ item.get_link|e('esc_url') }}">{{ item.title|e('esc_html')}}</a>
            </li>
          {% endif %}
        {% endfor %}
        
      </ul>
      
    </div>
  </nav>
{% endif %}

{# search form (modal) #}
<div id="ModalSearch" class="uk-modal-full uk-modal" uk-modal>
  <div class="uk-modal-dialog uk-flex uk-flex-center uk-flex-middle" uk-height-viewport>
    <a class="uk-modal-close-full uk-close">{{ snippets.close_menu_icon_large()|e('wp_kses_post') }}</a>
    <form class="uk-search uk-search-large" role="search" method="get" action="{{ site.url|e('esc_url') }}">
      <input id="header-search" class="uk-search-input uk-text-center" type="search" name="s" placeholder="{{ snippets.search_form_placeholder|e('esc_html') }}" 
      required maxlength="100" pattern=".*\S+.*" autocomplete="off" autofocus>
      <!-- <input type="hidden" name="post_type" value="product" /> -->
    </form>
  </div>
</div>